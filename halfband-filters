#!/usr/bin/julia
#
# a julia snippet to store my collection of halfband filter coefficients
#
# Harris2014 - Fred Harris, Elletra Venosa, Xiaofei Chin, Chris Dick,
# An efficient channelizer tree for portable software defined radios,
# Ann Telecommun ...
#
# shift-add-* - the naive shift and add filters
# sa-*-* - the searched shift and add matching remez-* to * components
# remez-3a remez optimal with 3 coeff and bands [0., .22, .28, .5]
# remez-*  remez optimal with * coeff and bands [0., 0.125, 0.375, 0.5]
# harris-23 
#
# puzzles:
#  remez-3 has -20dB aliases
#  sa-3-2 has better performance than remez-3 or sa-3-4
# 
# we need to simplify to the unique coefficients

using Printf

table = Dict(
    "shift-add-1" => [0.25000000],
    "shift-add-2" => [0.37500000],
    "shift-add-3" => [0.31250000],
    "shift-add-4" => [0.31250000, 0, -0.06250000000],
    "shift-add-5" => [0.31250000, 0, -0.06250000000, 0, 0.015625000000],
    "sa-3-1" =>      [0.25000000],
    "sa-3-2" =>      [0.28125000],
    "sa-3-4" =>      [0.29296875],
    "sa-7-1" =>      [0.25000000, 0, -0.06250000000],
    "sa-7-2" =>      [0.28125000, 0, -0.04687500000],
    "nb-7-4" =>      [0.29687500, 0, -0.05078125000],
    "sa-7-4" =>      [0.29687500, 0, -0.05078125000],
    "sa-11-1" =>     [0.25000000, 0, -0.06250000000, 0, 0.015625000000],
    "sa-11-2" =>     [0.31250000, 0, -0.06347656250, 0, 0.011718750000],
    "sa-11-4" =>     [0.30078125, 0, -0.06396484375, 0, 0.012939453125],
    "sa-15-1" =>     [0.25000000, 0, -0.06250000000, 0, 0.015625000000, 0, -0.003906250000],
    "sa-15-2" =>     [0.31250000, 0, -0.07031250000, 0, 0.019531250000, 0, -0.003906250000],
    "sa-15-4" =>     [0.30468750, 0, -0.07226562500, 0, 0.020507812500, 0, -0.003662109375],
    "sa-19-1" =>     [0.25000000, 0, -0.06250000000, 0, 0.031250000000, 0, -0.007812500000, 0, 0.000976562500],
    "sa-19-2" =>     [0.31250000, 0, -0.07812500000, 0, 0.023437500000, 0, -0.007812500000, 0, 0.001220703125],
    "sa-19-4" =>     [0.30468750, 0, -0.07812500000, 0, 0.026367187500, 0, -0.007080078125, 0, 0.001220703125],
    "sa-23-1" =>     [0.25000000, 0, -0.06250000000, 0, 0.031250000000, 0, -0.007812500000, 0, 0.001953125000, 0, -0.000244140625],
    "sa-23-2" =>     [0.31250000, 0, -0.07812500000, 0, 0.031250000000, 0, -0.009765625000, 0, 0.002441406250, 0, -0.000488281250],
    "sa-23-4" =>     [0.31250000, 0, -0.08203125000, 0, 0.031250000000, 0, -0.010253906250, 0, 0.002441406250, 0, -0.000976562500],
    "nb-27-4" =>     [0.31250000, 0, -0.08593750000, 0, 0.033935546875, 0, -0.0128173828125, 0, 0.003986358642578125, 0, -0.000885009765625, 0, 0.0001087188720703125],
    "remez-3-a" =>   [0.42109500],
    # path part  0    1           2   3              0  1               2   3               0  1               2   3              0 1        2  3
    # rev path   0    3           2   1              0  3               2   1               0  3               2   1              0 3        2  1
    "remez-3" =>     [0.2928932188134524000],
    "remez-7" =>     [0.2950593347029922000, 0, -0.0506241784254686500],
    "remez-11" =>    [0.3016129480756101000, 0, -0.0638715121040540600, 0, 0.0130492055520515],
    "remez-15" =>    [0.3053704736254272400, 0, -0.0723219047068619000, 0, 0.020569894870082088, 0, -0.003737655732607951],
    "remez-19" =>    [0.3077635064852536400, 0, -0.0779526660762244700, 0, 0.026198090542835655, 0, -0.007112559625747375, 0, 0.0011219532857516855],
    "remez-23" =>    [0.3094197496488096000, 0, -0.0819836023139007300, 0, 0.030554571174505343, 0, -0.010160358193798472, 0, 
                      0.0025138161054590010, 0, -0.0003470657563350926],
    "remez-23-w" =>  [0.3097348426468856000, 0, -0.0827449847275144900, 0, 0.031364855752844220, 0, -0.010712628595648395, 0, 
                      0.0027555068206161370, 0, -0.0004024836240035487],
    "remez-27" =>    [0.3106238933985496000, 0, -0.0849921365028206300, 0, 0.033999402943937680, 0, -0.012833980535171110, 0, 
                      0.0039866876770145580, 0, -0.0008923653753453863, 0, 0.00010895591745473263],
    "remez-3-t" =>   [0.29289300],
    "remez-7-t" =>   [0.29505900, 0, -0.05062400000],
    "remez-11-t" =>  [0.30161300, 0, -0.06387200000, 0, 0.013049000000],
    "remez-15-t" =>  [0.30537000, 0, -0.07232190000, 0, 0.020569900000, 0, -0.003737660000],
    "remez-19-t" =>  [0.30776400, 0, -0.07795270000, 0, 0.026198100000, 0, -0.007112560000, 0, 0.001121950000],
    "remez-23-t" =>  [0.30942000, 0, -0.08198360000, 0, 0.030554600000, 0, -0.010160400000, 0, 0.002513820000, 0, -0.000347066000],
    "remez-27-t" =>  [0.31062389, 0, -0.08499213650, 0, 0.033999402944, 0, -0.012833980535, 0, 0.003986687677, 0, -0.000892365375, 0, 0.00010895591745473263],
    "harris-23" =>   [0.30970000, 0, -0.08280000000, 0, 0.031400000000, 0, -0.010700000000, 0, 0.002800000000, 0, -0.000400000000],
)

function namenumnum(name)
    parts = split(name, "-")
    if length(parts) > 1
        p2 = tryparse(Int64, parts[2])
        if p2 != nothing
            parts[2] = @sprintf("%02d", p2)
        end
        if length(parts) > 2
            p3 = tryparse(Int64, parts[3])
            if p3 != nothing
                parts[3] = @sprintf("%02d", p3)
            end
        end
    end
    join(parts, "-")
end

for arg in ARGS
    if arg == "all"
        # list all the known tags
        println(join(sort(collect(keys(table)), by=namenumnum), " "))
        exit(0)
    end
    v = get(table, arg, nothing)
    if v == nothing
        println("invalid halfband name $arg")
        exit(1)
    end
    println(join([reverse(v); 0.5; v], " "))
end
            
